<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will's Week 2 Meal Planner Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 30px 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 300;
            letter-spacing: 0.3px;
        }
        
        /* Glassmorphism Filters */
        .filters-bar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.6s ease 0.2s backwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1024px) {
            .filter-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 640px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .filter-item h4 {
            color: white;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 0.3px;
        }
        
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        select option {
            background: #2a5298;
            color: white;
        }
        
        select:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.2);
        }
        
        select:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        
        button:focus-visible {
            outline: 3px solid rgba(96, 165, 250, 0.5);
            outline-offset: 2px;
        }
        
        .remove-btn:focus-visible {
            outline: 2px solid rgba(239, 68, 68, 0.5);
            outline-offset: 2px;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 32px;
        }
        
        .tag {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
            animation: tagSlideIn 0.3s ease;
        }
        
        @keyframes tagSlideIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .tag.green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .tag.green:hover {
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .tag-x {
            cursor: pointer;
            font-weight: 700;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .tag-x:hover {
            opacity: 1;
        }
        
        .empty-tag {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            font-style: italic;
        }
        
        .quick-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .browse-recipes-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);
            letter-spacing: 0.3px;
        }
        
        .browse-recipes-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.35);
        }
        
        .recipe-browser-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recipe-browser-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .recipe-browser-card:hover {
            transform: translateY(-4px);
            border-color: #6366f1;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }
        
        .recipe-browser-card.expanded {
            border-color: #6366f1;
            cursor: default;
        }
        
        .recipe-browser-card h4 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .recipe-browser-card .badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            margin-top: 8px;
        }
        
        .recipe-details {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            animation: slideInUp 0.3s ease;
        }
        
        .recipe-details.show {
            display: block;
        }
        
        .recipe-browser-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .recipe-browser-actions button {
            padding: 10px 18px;
            font-size: 0.85rem;
        }
        
        .expand-recipe-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
            font-weight: 600;
        }
        
        .expand-recipe-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: none;
        }
        
        .recipe-category-header {
            color: white;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .recipe-category-header:first-child {
            margin-top: 0;
        }
        
        /* Main layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            animation: fadeIn 0.6s ease 0.3s backwards;
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Generator section */
        .generator-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 35px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.15);
            padding: 6px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tab {
            flex: 1;
            padding: 14px 24px;
            background: transparent;
            border: none;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }
        
        .tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab.active {
            color: white;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        .meal-box {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.15);
        }
        
        .meal-box:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .meal-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: white;
            letter-spacing: -0.5px;
        }
        
        .portions-badge {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        .clear-recipe-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .clear-recipe-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: none;
            box-shadow: none;
        }
        
        .recipe-display {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            min-height: 250px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.15);
        }
        
        .recipe-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .recipe-top {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .recipe-icon {
            font-size: 3.5rem;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.1));
        }
        
        .recipe-info {
            flex: 1;
        }
        
        .recipe-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
            letter-spacing: -0.3px;
        }
        
        .recipe-source {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .recipe-source a {
            color: #6366f1;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }
        
        .recipe-source a:hover {
            color: #4f46e5;
            text-decoration: underline;
        }
        
        .recipe-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .badge {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #475569;
            border: 1.5px solid #e2e8f0;
        }
        
        .rating {
            color: #f59e0b;
            font-weight: 700;
        }
        
        .component {
            background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #6366f1;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        
        .component h4 {
            color: #6366f1;
            font-size: 1.1rem;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.2px;
        }
        
        .component-detail {
            color: #475569;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .instructions-list {
            margin-top: 12px;
        }
        
        .instruction-step {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            font-size: 0.95rem;
            color: #475569;
            line-height: 1.7;
            font-weight: 500;
        }
        
        .instruction-step::before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #6366f1;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .storage-note {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            padding: 14px 18px;
            border-radius: 12px;
            font-size: 0.9rem;
            color: #065f46;
            margin-top: 20px;
            font-weight: 600;
            border: 1.5px solid #a7f3d0;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
            letter-spacing: 0.3px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }
        
        .btn-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
        }
        
        .btn-green:hover {
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.35);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.25);
        }
        
        .btn-purple:hover {
            box-shadow: 0 8px 20px rgba(168, 85, 247, 0.35);
        }
        
        .btn-pink {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.25);
        }
        
        .btn-pink:hover {
            box-shadow: 0 8px 20px rgba(236, 72, 153, 0.35);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .sidebar-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.6s ease 0.4s backwards;
        }
        
        .sidebar-card h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        .weekly-meal {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 16px;
            border-radius: 14px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #6366f1;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }
        
        .weekly-meal:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .weekly-meal-info {
            flex: 1;
        }
        
        .weekly-meal-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
            margin-bottom: 6px;
            letter-spacing: -0.1px;
        }
        
        .weekly-meal-type {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .remove-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }
        
        .remove-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        .favorite-item {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.15);
        }
        
        .favorite-item:hover {
            border-color: #f59e0b;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.25);
        }
        
        .favorite-name {
            font-weight: 600;
            color: #78350f;
            font-size: 0.9rem;
            margin-bottom: 6px;
        }
        
        .favorite-meta {
            font-size: 0.8rem;
            color: #a16207;
            font-weight: 500;
        }
        
        .favorite-preview {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin-top: 10px;
            animation: slideInUp 0.4s ease;
        }
        
        .favorite-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .favorite-preview-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .close-preview-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .close-preview-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: none;
        }
        
        .empty-state {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            padding: 40px 20px;
            font-style: italic;
            font-size: 0.95rem;
        }
        
        /* Shopping List */
        .shopping-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 35px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.6s ease 0.5s backwards;
        }
        
        .shopping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .shopping-header h2 {
            color: white;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .shopping-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 25px;
        }
        
        @media (max-width: 768px) {
            .shopping-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .shopping-category {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .shopping-category h4 {
            color: white;
            margin-bottom: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.2px;
        }
        
        .shopping-item {
            padding: 12px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.15);
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .shopping-item:last-child {
            border-bottom: none;
        }
        
        .shopping-item strong {
            color: white;
            font-weight: 700;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 24px;
            padding: 40px;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.7);
            background: none;
            border: none;
            padding: 0;
            width: auto;
            height: auto;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            color: white;
            transform: rotate(90deg);
        }
        
        .modal-content h2 {
            color: white !important;
        }
        
        /* Past list cards */
        .past-list-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .past-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .past-list-header h3 {
            color: white !important;
            margin: 0 !important;
            font-size: 1.3rem;
        }
        
        .past-list-meals {
            margin-bottom: 20px;
        }
        
        .past-list-meals strong {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            display: block;
            margin-bottom: 10px;
        }
        
        .past-list-meal-item {
            font-size: 0.9rem;
            padding: 6px 0;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 18px 24px;
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.4s ease, fadeOut 0.4s ease 2.6s forwards;
            border-left: 4px solid #6366f1;
        }
        
        .toast.success {
            border-left-color: #10b981;
        }
        
        .toast.error {
            border-left-color: #ef4444;
        }
        
        .toast-icon {
            font-size: 1.5rem;
        }
        
        .toast-message {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Pulse animation for generate button */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        button:not(:disabled):hover {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        /* Slide in animation for generated recipes */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .recipe-card {
            animation: slideInUp 0.5s ease;
        }
        
        /* Shimmer loading effect */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .loading-skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.05) 75%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
            border-radius: 12px;
            height: 200px;
        }
        
        /* Enhanced button glow */
        button:not(:disabled):active {
            transform: scale(0.97);
        }
        
        .btn-green:not(:disabled):hover {
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
        }
        
        .btn-purple:not(:disabled):hover {
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.6);
        }
        
        .btn-pink:not(:disabled):hover {
            box-shadow: 0 0 30px rgba(236, 72, 153, 0.6);
        }
        
        /* Card hover lift */
        .weekly-meal,
        .favorite-item,
        .component {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .weekly-meal:hover,
        .favorite-item:hover {
            transform: translateY(-3px) translateX(4px);
        }
        
        .component:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        /* Stagger animation for lists */
        .weekly-meal {
            animation: slideInLeft 0.3s ease backwards;
        }
        
        .weekly-meal:nth-child(1) { animation-delay: 0.05s; }
        .weekly-meal:nth-child(2) { animation-delay: 0.1s; }
        .weekly-meal:nth-child(3) { animation-delay: 0.15s; }
        .weekly-meal:nth-child(4) { animation-delay: 0.2s; }
        .weekly-meal:nth-child(5) { animation-delay: 0.25s; }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Tag pop-in animation */
        .tag {
            animation: tagPop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes tagPop {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            70% {
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Fridge Tracker Items */
        .fridge-item {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .fridge-item.fresh {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .fridge-item.soon {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        
        .fridge-item.urgent {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            animation: pulseFridge 2s ease-in-out infinite;
        }
        
        @keyframes pulseFridge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .fridge-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .fridge-item-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .fridge-item-amount {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }
        
        .fridge-item-dates {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .freshness-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .freshness-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .freshness-fill.fresh {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }
        
        .freshness-fill.soon {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }
        
        .freshness-fill.urgent {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }
        
        .freshness-text {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .fridge-item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .fridge-item-actions button {
            padding: 10px 18px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Will's Week 2 Meal Planner Pro</h1>
            <p class="subtitle">Mix & match components or choose complete meals</p>
        </header>
        
        <!-- Filters Bar -->
        <div class="filters-bar">
            <div class="filter-grid">
                <div class="filter-item">
                    <h4>üö´ Exclude</h4>
                    <select id="exclude-select" onchange="addExclusion()">
                        <option value="">Select to exclude...</option>
                    </select>
                    <div class="tags" id="exclude-tags">
                        <span class="empty-tag">None</span>
                    </div>
                </div>
                
                <div class="filter-item">
                    <h4>üßä In Fridge/Pantry</h4>
                    <select id="fridge-select" onchange="addFridge()">
                        <option value="">What you have...</option>
                    </select>
                    <div class="tags" id="fridge-tags">
                        <span class="empty-tag">None</span>
                    </div>
                </div>
                
                <div class="filter-item">
                    <h4>‚è±Ô∏è Cook Time</h4>
                    <select id="time-filter">
                        <option value="any">Any Time</option>
                        <option value="quick">Under 20 min</option>
                        <option value="medium">20-40 min</option>
                        <option value="long">40+ min</option>
                    </select>
                </div>
                
                <div class="filter-item">
                    <h4>üîß Equipment</h4>
                    <select id="equipment-filter">
                        <option value="any">Any</option>
                        <option value="airfryer">Air Fryer</option>
                        <option value="stovetop">Stovetop</option>
                        <option value="oven">Oven</option>
                    </select>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="btn-secondary" onclick="clearFilters()">Clear Filters</button>
                <button class="browse-recipes-btn" onclick="openRecipeBrowser()">üìö Browse All Recipes</button>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Generator Section -->
            <div class="generator-section">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('component')">Component Recipes</button>
                    <button class="tab" onclick="switchTab('complete')">Complete Meals</button>
                    <button class="tab" onclick="switchTab('mealprep')">Meal Prep üç±</button>
                </div>
                
                <!-- Component Tab -->
                <div id="component-tab" class="tab-content active">
                    <!-- Lunch -->
                    <div class="meal-box">
                        <div class="meal-header">
                            <div class="meal-title">Lunch</div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="portions-badge">1.5P ‚Ä¢ 1.5C ‚Ä¢ 1.5V ‚Ä¢ 1F</div>
                                <button class="clear-recipe-btn" onclick="clearRecipe('comp-lunch')">‚úï Clear</button>
                            </div>
                        </div>
                        <div id="comp-lunch-display" class="recipe-display">
                            <div class="empty-state">Click generate to build your lunch</div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="generateComponent('lunch', false)">üé≤ Generate</button>
                            <button class="btn-green" onclick="generateComponent('lunch', true)" id="fridge-lunch" disabled>
                                üßä Use Fridge
                            </button>
                            <button class="btn-purple" onclick="addToWeek('comp-lunch')">‚ûï Add to Shopping List</button>
                            <button class="btn-pink" onclick="addFavorite('comp-lunch')">‚ù§Ô∏è Favorite</button>
                        </div>
                    </div>
                    
                    <!-- Dinner -->
                    <div class="meal-box">
                        <div class="meal-header">
                            <div class="meal-title">Dinner</div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="portions-badge">1.5P ‚Ä¢ 2V ‚Ä¢ 1F</div>
                                <button class="clear-recipe-btn" onclick="clearRecipe('comp-dinner')">‚úï Clear</button>
                            </div>
                        </div>
                        <div id="comp-dinner-display" class="recipe-display">
                            <div class="empty-state">Click generate to build your dinner</div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="generateComponent('dinner', false)">üé≤ Generate</button>
                            <button class="btn-green" onclick="generateComponent('dinner', true)" id="fridge-dinner" disabled>
                                üßä Use Fridge
                            </button>
                            <button class="btn-purple" onclick="addToWeek('comp-dinner')">‚ûï Add to Shopping List</button>
                            <button class="btn-pink" onclick="addFavorite('comp-dinner')">‚ù§Ô∏è Favorite</button>
                        </div>
                    </div>
                </div>
                
                <!-- Complete Tab -->
                <div id="complete-tab" class="tab-content">
                    <!-- Lunch -->
                    <div class="meal-box">
                        <div class="meal-header">
                            <div class="meal-title">Lunch</div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="portions-badge">Complete Meal</div>
                                <button class="clear-recipe-btn" onclick="clearRecipe('complete-lunch')">‚úï Clear</button>
                            </div>
                        </div>
                        <div id="complete-lunch-display" class="recipe-display">
                            <div class="empty-state">Click generate for a complete lunch recipe</div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="generateComplete('lunch')">üé≤ Generate</button>
                            <button class="btn-purple" onclick="addToWeek('complete-lunch')">‚ûï Add to Shopping List</button>
                            <button class="btn-pink" onclick="addFavorite('complete-lunch')">‚ù§Ô∏è Favorite</button>
                        </div>
                    </div>
                    
                    <!-- Dinner -->
                    <div class="meal-box">
                        <div class="meal-header">
                            <div class="meal-title">Dinner</div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="portions-badge">Complete Meal</div>
                                <button class="clear-recipe-btn" onclick="clearRecipe('complete-dinner')">‚úï Clear</button>
                            </div>
                        </div>
                        <div id="complete-dinner-display" class="recipe-display">
                            <div class="empty-state">Click generate for a complete dinner recipe</div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="generateComplete('dinner')">üé≤ Generate</button>
                            <button class="btn-purple" onclick="addToWeek('complete-dinner')">‚ûï Add to Shopping List</button>
                            <button class="btn-pink" onclick="addFavorite('complete-dinner')">‚ù§Ô∏è Favorite</button>
                        </div>
                    </div>
                </div>
                
                <!-- Meal Prep Tab -->
                <div id="mealprep-tab" class="tab-content">
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 30px; font-size: 0.95rem; line-height: 1.6;">
                        <strong style="color: white; font-size: 1.1rem;">üç± Batch Cooking Made Easy</strong><br>
                        Select recipes below and specify how many servings to make. Perfect for weekly meal prep!
                        The tool will calculate your shopping list and show you how long each recipe stays fresh.
                    </div>
                    
                    <div id="mealprep-slots">
                        <!-- Recipe Slot 1 -->
                        <div class="meal-box">
                            <div class="meal-header">
                                <div class="meal-title">Recipe #1</div>
                            </div>
                            <div id="prep-slot-1" class="recipe-display">
                                <div class="empty-state">Click "Select Recipe" to choose what to batch cook</div>
                            </div>
                            <div class="action-buttons">
                                <button onclick="selectPrepRecipe(1)">üìã Select Recipe</button>
                                <div id="prep-servings-1" style="display: none; align-items: center; gap: 10px;">
                                    <label style="color: white; font-weight: 600;">Servings:</label>
                                    <select id="prep-qty-1" onchange="updateShelfLifeBreakdown()" style="padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-weight: 600;">
                                        <option value="2">2 servings</option>
                                        <option value="3">3 servings</option>
                                        <option value="4" selected>4 servings</option>
                                        <option value="5">5 servings</option>
                                        <option value="6">6 servings</option>
                                        <option value="7">7 servings</option>
                                        <option value="8">8 servings</option>
                                        <option value="10">10 servings</option>
                                        <option value="12">12 servings</option>
                                    </select>
                                    <button class="clear-recipe-btn" onclick="clearPrepSlot(1)">‚úï Clear</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recipe Slot 2 -->
                        <div class="meal-box">
                            <div class="meal-header">
                                <div class="meal-title">Recipe #2</div>
                            </div>
                            <div id="prep-slot-2" class="recipe-display">
                                <div class="empty-state">Add a second recipe (optional)</div>
                            </div>
                            <div class="action-buttons">
                                <button onclick="selectPrepRecipe(2)">üìã Select Recipe</button>
                                <div id="prep-servings-2" style="display: none; align-items: center; gap: 10px;">
                                    <label style="color: white; font-weight: 600;">Servings:</label>
                                    <select id="prep-qty-2" onchange="updateShelfLifeBreakdown()" style="padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-weight: 600;">
                                        <option value="2">2 servings</option>
                                        <option value="3">3 servings</option>
                                        <option value="4" selected>4 servings</option>
                                        <option value="5">5 servings</option>
                                        <option value="6">6 servings</option>
                                        <option value="7">7 servings</option>
                                        <option value="8">8 servings</option>
                                        <option value="10">10 servings</option>
                                        <option value="12">12 servings</option>
                                    </select>
                                    <button class="clear-recipe-btn" onclick="clearPrepSlot(2)">‚úï Clear</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recipe Slot 3 -->
                        <div class="meal-box">
                            <div class="meal-header">
                                <div class="meal-title">Recipe #3</div>
                            </div>
                            <div id="prep-slot-3" class="recipe-display">
                                <div class="empty-state">Add a third recipe (optional)</div>
                            </div>
                            <div class="action-buttons">
                                <button onclick="selectPrepRecipe(3)">üìã Select Recipe</button>
                                <div id="prep-servings-3" style="display: none; align-items: center; gap: 10px;">
                                    <label style="color: white; font-weight: 600;">Servings:</label>
                                    <select id="prep-qty-3" onchange="updateShelfLifeBreakdown()" style="padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-weight: 600;">
                                        <option value="2">2 servings</option>
                                        <option value="3">3 servings</option>
                                        <option value="4" selected>4 servings</option>
                                        <option value="5">5 servings</option>
                                        <option value="6">6 servings</option>
                                        <option value="7">7 servings</option>
                                        <option value="8">8 servings</option>
                                        <option value="10">10 servings</option>
                                        <option value="12">12 servings</option>
                                    </select>
                                    <button class="clear-recipe-btn" onclick="clearPrepSlot(3)">‚úï Clear</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shelf Life Breakdown -->
                    <div id="shelf-life-section" style="margin-top: 30px; padding-top: 30px; border-top: 2px solid rgba(255,255,255,0.2); display: none;">
                        <h3 style="color: white; font-size: 1.4rem; font-weight: 700; margin-bottom: 20px;">
                            ‚ùÑÔ∏è Shelf Life Guide
                        </h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px; font-size: 0.9rem;">
                            Here's how long each batch-cooked item stays fresh in the refrigerator:
                        </p>
                        <div id="shelf-life-breakdown" class="shopping-grid"></div>
                    </div>
                    
                    <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid rgba(255,255,255,0.2);">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button onclick="addAllPrepToWeek()" style="flex: 1; min-width: 250px; padding: 18px; font-size: 1.1rem; font-weight: 700;">
                                ‚ûï Add All to This Week's Plan
                            </button>
                            <button onclick="addAnotherPrepSlot()" class="btn-secondary" style="padding: 18px 28px; font-size: 1rem; font-weight: 600;">
                                ‚ûï Add Another Recipe Slot
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- This Week -->
                <div class="sidebar-card">
                    <h3>üìÖ This Week's Plan</h3>
                    <div id="weekly-meals">
                        <div class="empty-state" style="padding: 20px;">No meals added yet</div>
                    </div>
                </div>
                
                <!-- Favorites -->
                <div class="sidebar-card">
                    <h3>‚≠ê Favorites</h3>
                    <div id="favorites-list">
                        <div class="empty-state" style="padding: 20px;">No favorites yet</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Shopping List Section -->
        <div class="shopping-section">
            <div class="shopping-header">
                <h2 style="color: #667eea; margin: 0;">üõí Current Shopping List</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-secondary" onclick="clearShoppingList()">üóëÔ∏è Clear List</button>
                    <button class="btn-secondary" onclick="viewPastLists()">üìã Past Lists</button>
                    <button class="btn-green" onclick="saveAndStartNew()" id="save-list-btn" disabled>Save & Start New</button>
                </div>
            </div>
            <div id="current-shopping-list">
                <div class="empty-state">Add meals to "This Week's Plan" to build your shopping list</div>
            </div>
            
            <!-- Mark as Purchased Section -->
            <div id="purchase-section" style="margin-top: 25px; padding-top: 25px; border-top: 2px solid rgba(255,255,255,0.2); display: none;">
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn-green" onclick="markAllPurchased()" style="padding: 16px 32px; font-size: 1.1rem; font-weight: 700;">
                        ‚úÖ Mark All as Purchased
                    </button>
                    <button class="btn-purple" onclick="openManualAddFromPage1()" style="padding: 16px 32px; font-size: 1.1rem; font-weight: 700;">
                        ‚ûï Add Extra Items
                    </button>
                </div>
                <p style="text-align: center; color: rgba(255,255,255,0.7); margin-top: 15px; font-size: 0.9rem;">
                    After marking as purchased, go to Cook & Track page to see your fridge!
                </p>
            </div>
            
            <!-- Cook & Track Button -->
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid rgba(255,255,255,0.2); text-align: center;">
                <h3 style="color: white; margin-bottom: 15px; font-size: 1.3rem;">üõí Got Your Groceries?</h3>
                <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px; font-size: 0.95rem;">
                    Track your ingredients, monitor freshness, and know exactly what to cook next!
                </p>
                <a href="cook-track.html" style="text-decoration: none;">
                    <button class="btn-purple" style="padding: 18px 36px; font-size: 1.1rem; font-weight: 700; width: 100%; max-width: 400px;">
                        üë®‚Äçüç≥ Go to Cook & Track Page
                    </button>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Past Lists Modal -->
    <div id="past-lists-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="modal-close" onclick="closeModal('past-lists-modal')">√ó</button>
            <h2 style="color: #667eea; margin-bottom: 20px;">üìã Past Shopping Lists</h2>
            <div id="past-lists-content"></div>
        </div>
    </div>
    
    <!-- Recipe Browser Modal -->
    <div id="recipe-browser-modal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <button class="modal-close" onclick="closeModal('recipe-browser-modal')">√ó</button>
            <h2 style="color: white; margin-bottom: 10px;">üìö Browse All Recipes</h2>
            <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px; font-size: 0.95rem;">
                Click any recipe to use it in your meal plan
            </p>
            <div id="recipe-browser-content"></div>
        </div>
    </div>

    <script>
        /*
        ========================================
        HOW TO ADD NEW RECIPES
        ========================================
        
        1. Find the recipe arrays below (proteinRecipes, veggieRecipes, carbRecipes)
        2. Copy the example format
        3. Paste a new recipe object
        4. Fill in all fields (name, protein/veggie/carb, icon, time, etc.)
        5. Save this file
        6. Re-upload to your hosting (GitHub Pages, Google Drive, etc.)
        
        EXAMPLE PROTEIN RECIPE:
        {
            name: "Pan-Seared Chicken",
            protein: "chicken breast",
            icon: "üçó",
            time: 15,
            difficulty: "easy",
            equipment: "stovetop",
            source: "CJ Eats Recipes",
            sourceUrl: "https://cjeatsrecipes.com/pan-seared-chicken-breasts/",
            rating: 4.8,
            instructions: [
                "Season chicken with salt, pepper, garlic powder",
                "Heat oil in pan over medium-high",
                "Sear 3-4 min per side until 165¬∞F",
                "Rest 5 min before slicing"
            ]
        }
        
        Just copy this format and change the values!
        ========================================
        */
        
        // Ingredient lists
        const allIngredients = {
            proteins: ['Chicken Breast', 'Ground Bison', '99% Lean Turkey', 'Pork Tenderloin', 
                      'Lean Grass-Fed Beef', 'White Fish', 'Tuna', 'Shrimp', 'Crab', 'Lobster'],
            carbs: ['Sweet Potato', 'Red Potato', 'White Rice', 'Ezekiel Bread', 'Quinoa'],
            veggies: ['Broccoli', 'Brussels Sprouts', 'Green Beans', 'Red Cabbage', 'Cabbage', 'Onion']
        };

        // PROTEIN RECIPES - Add more here!
        const proteinRecipes = [
            {
                name: "Pan-Seared Chicken Breast",
                protein: "chicken breast",
                icon: "üçó",
                time: 15,
                difficulty: "easy",
                equipment: "stovetop",
                source: "CJ Eats Recipes",
                sourceUrl: "https://cjeatsrecipes.com/pan-seared-chicken-breasts/",
                rating: 4.9,
                instructions: [
                    "Slice chicken into 1/2 inch filets and pat dry",
                    "Season with salt, pepper, garlic powder, onion powder, oregano, thyme",
                    "Heat neutral oil in nonstick pan over medium-high",
                    "Sear 3-4 min per side until golden and 165¬∞F internal",
                    "Rest 5 min before slicing"
                ]
            },
            {
                name: "Simple Ground Bison Skillet",
                protein: "ground bison",
                icon: "üçñ",
                time: 10,
                difficulty: "easy",
                equipment: "stovetop",
                source: "Marin Mama Cooks",
                sourceUrl: "https://marinmamacooks.com/quick-and-easy-ground-bison-for-meal-prep/",
                rating: 4.7,
                instructions: [
                    "Heat avocado oil with Celtic sea salt in skillet over medium",
                    "Add ground bison and saut√©, breaking up with wooden spoon",
                    "Cook 4-5 min until browned",
                    "Add coconut aminos, lemon juice, and green onions",
                    "Turn off heat and stir to combine"
                ]
            },
            {
                name: "Ground Turkey Skillet",
                protein: "99% lean turkey",
                icon: "ü¶É",
                time: 20,
                difficulty: "easy",
                equipment: "stovetop",
                source: "A Paige of Positivity",
                sourceUrl: "https://apaigeofpositivity.com/ground-turkey-skillet-recipe/",
                rating: 4.8,
                instructions: [
                    "Heat skillet with oil, add turkey with salt, paprika, onion powder",
                    "Break up meat while cooking, about 6 min",
                    "Push meat aside, add onions with more oil, saut√© few min",
                    "Drain excess liquid if more than 2 tbsp",
                    "Add seasonings and cook through"
                ]
            },
            // PLACEHOLDER - Add more proteins here (pork, beef, fish, tuna, shrimp, crab, lobster)
        ];

        // VEGGIE RECIPES - Add more here!
        const veggieRecipes = [
            {
                name: "Roasted Brussels Sprouts",
                veggie: "brussels sprouts",
                icon: "ü•¨",
                time: 20,
                difficulty: "easy",
                equipment: "oven",
                source: "Ready to add source",
                sourceUrl: "#",
                rating: 4.8,
                instructions: [
                    "Preheat oven to 425¬∞F",
                    "Halve Brussels sprouts",
                    "Toss with olive oil, salt, pepper",
                    "Roast 20 min, tossing halfway",
                    "Cook until crispy and golden"
                ]
            },
            {
                name: "Roasted Broccoli",
                veggie: "broccoli",
                icon: "ü•¶",
                time: 15,
                difficulty: "easy",
                equipment: "oven",
                source: "Ready to add source",
                sourceUrl: "#",
                rating: 4.7,
                instructions: [
                    "Preheat oven to 425¬∞F",
                    "Cut broccoli into florets",
                    "Toss with oil, salt, garlic powder",
                    "Roast 15 min until edges crispy",
                    "Serve hot"
                ]
            },
            // PLACEHOLDER - Add more veggies (green beans, red cabbage, cabbage, onion)
        ];

        // CARB RECIPES - Add more here!
        const carbRecipes = [
            {
                name: "Crispy Sweet Potato Cubes",
                carb: "sweet potato",
                icon: "üç†",
                time: 25,
                difficulty: "easy",
                equipment: "airfryer",
                source: "Ready to add source",
                sourceUrl: "#",
                rating: 4.9,
                instructions: [
                    "Cube sweet potato into 1-inch pieces",
                    "Toss with oil, salt, paprika",
                    "Air fry 400¬∞F for 20-25 min",
                    "Shake basket halfway through",
                    "Cook until golden and crispy"
                ]
            },
            {
                name: "Perfect Fluffy White Rice",
                carb: "white rice",
                icon: "üçö",
                time: 20,
                difficulty: "easy",
                equipment: "stovetop",
                source: "Ready to add source",
                sourceUrl: "#",
                rating: 4.8,
                instructions: [
                    "Rinse rice until water runs clear",
                    "Use 2:1 water to rice ratio",
                    "Bring to boil, cover, reduce to simmer",
                    "Cook 18 min, don't lift lid",
                    "Rest 5 min covered, then fluff"
                ]
            },
            // PLACEHOLDER - Add more carbs (red potato, ezekiel bread, quinoa)
        ];

        // COMPLETE MEALS - Add more here!
        const completeMeals = {
            lunch: [
                {
                    name: "Mediterranean Turkey Bowl",
                    icon: "ü•ô",
                    protein: "turkey",
                    carb: "white rice",
                    veggie: "spinach",
                    time: 30,
                    difficulty: "easy",
                    equipment: "stovetop",
                    source: "Ready to add source",
                    sourceUrl: "#",
                    rating: 4.6,
                    ingredients: ["Ground turkey", "White rice", "Spinach", "Olive oil", "Lemon", "Oregano"],
                    instructions: [
                        "Cook rice according to package",
                        "Brown turkey with oregano and garlic",
                        "Wilt spinach in separate pan",
                        "Combine all with lemon juice and olive oil",
                        "Serve hot"
                    ]
                },
                // PLACEHOLDER - Add more complete lunch recipes
            ],
            dinner: [
                {
                    name: "Garlic Herb Chicken & Greens",
                    icon: "üçó",
                    protein: "chicken",
                    veggie: "broccoli",
                    time: 25,
                    difficulty: "easy",
                    equipment: "stovetop",
                    source: "Ready to add source",
                    sourceUrl: "#",
                    rating: 4.5,
                    ingredients: ["Chicken breast", "Broccoli", "Garlic", "Herbs", "Olive oil"],
                    instructions: [
                        "Season and sear chicken",
                        "Roast broccoli alongside",
                        "Make pan sauce with garlic",
                        "Combine and serve"
                    ]
                },
                // PLACEHOLDER - Add more complete dinner recipes
            ]
        };

        // State
        let current = {
            'comp-lunch': null,
            'comp-dinner': null,
            'complete-lunch': null,
            'complete-dinner': null
        };
        let excluded = new Set(JSON.parse(localStorage.getItem('excluded') || '[]'));
        let fridge = new Set(JSON.parse(localStorage.getItem('fridge') || '[]'));
        let weeklyMeals = JSON.parse(localStorage.getItem('weekly') || '[]');
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let pastLists = JSON.parse(localStorage.getItem('pastLists') || '[]');

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            populateSelects();
            updateTags();
            updateFridgeButtons();
            renderWeekly();
            renderFavorites();
            updateShoppingList();
        });

        function populateSelects() {
            // Get actual fridge items from localStorage (raw items only)
            const fridgeItems = JSON.parse(localStorage.getItem('fridgeItems') || '[]');
            const rawFridgeItems = fridgeItems.filter(item => item.status === 'raw');
            const fridgeIngredients = [...new Set(rawFridgeItems.map(item => item.name.toLowerCase()))]; // Unique names
            
            const all = [...allIngredients.proteins, ...allIngredients.carbs, ...allIngredients.veggies].sort();
            const ex = document.getElementById('exclude-select');
            const fr = document.getElementById('fridge-select');
            
            // Populate exclude dropdown with all ingredients
            all.forEach(item => {
                ex.add(new Option(item, item.toLowerCase()));
            });
            
            // Populate fridge dropdown ONLY with items actually in fridge/pantry
            fridgeIngredients.forEach(item => {
                fr.add(new Option(cap(item), item));
            });
        }

        function addExclusion() {
            const val = document.getElementById('exclude-select').value;
            if (val) {
                excluded.add(val);
                save('excluded', excluded);
                updateTags();
            }
            document.getElementById('exclude-select').value = '';
        }

        function addFridge() {
            const val = document.getElementById('fridge-select').value;
            if (val) {
                fridge.add(val);
                save('fridge', fridge);
                updateTags();
                updateFridgeButtons();
            }
            document.getElementById('fridge-select').value = '';
        }

        function updateTags() {
            const exEl = document.getElementById('exclude-tags');
            const frEl = document.getElementById('fridge-tags');
            
            exEl.innerHTML = excluded.size ? [...excluded].map(i => 
                `<span class="tag">${cap(i)} <span class="tag-x" onclick="remove('excluded','${i}')">√ó</span></span>`
            ).join('') : '<span class="empty-tag">None</span>';
            
            frEl.innerHTML = fridge.size ? [...fridge].map(i => 
                `<span class="tag green">${cap(i)} <span class="tag-x" onclick="remove('fridge','${i}')">√ó</span></span>`
            ).join('') : '<span class="empty-tag">None</span>';
        }

        function remove(type, item) {
            if (type === 'excluded') {
                excluded.delete(item);
                save('excluded', excluded);
                updateTags();
            } else {
                fridge.delete(item);
                save('fridge', fridge);
                updateTags();
                updateFridgeButtons();
            }
        }

        function updateFridgeButtons() {
            const has = fridge.size > 0;
            document.getElementById('fridge-lunch').disabled = !has;
            document.getElementById('fridge-dinner').disabled = !has;
        }

        function generateComponent(meal, useFridge) {
            let prots = proteinRecipes.filter(r => !excluded.has(r.protein));
            let vegs = veggieRecipes.filter(r => !excluded.has(r.veggie));
            let carbs = carbRecipes.filter(r => !excluded.has(r.carb));
            
            if (useFridge) {
                prots = prots.filter(r => fridge.has(r.protein));
                vegs = vegs.filter(r => fridge.has(r.veggie));
                carbs = carbs.filter(r => fridge.has(r.carb));
            }
            
            if (prots.length === 0 || vegs.length === 0 || (meal === 'lunch' && carbs.length === 0)) {
                showToast('No recipes match your filters!', 'error');
                return;
            }
            
            // Show loading state
            const displayEl = document.getElementById(`comp-${meal}-display`);
            displayEl.innerHTML = '<div class="loading-skeleton"></div>';
            
            // Simulate loading for smooth UX
            setTimeout(() => {
                const p = rand(prots);
                const v = rand(vegs);
                const c = meal === 'lunch' ? rand(carbs) : null;
                
                current[`comp-${meal}`] = { type: 'component', meal, protein: p, veggie: v, carb: c };
                displayComponent(meal, p, v, c);
            }, 500);
        }

        function displayComponent(meal, p, v, c) {
            const el = document.getElementById(`comp-${meal}-display`);
            const total = p.time + v.time + (c ? c.time : 0);
            
            el.innerHTML = `
                <div class="recipe-card">
                    <div class="recipe-top">
                        <div class="recipe-icon">${p.icon}${c ? c.icon : ''}${v.icon}</div>
                        <div class="recipe-info">
                            <div class="recipe-name">Component ${meal === 'lunch' ? 'Lunch' : 'Dinner'}</div>
                            <div class="recipe-badges">
                                <span class="badge">‚è±Ô∏è ~${total}min</span>
                                <span class="badge">üì¶ 2x portions</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="component">
                        <h4>üçñ ${p.name}</h4>
                        <div class="recipe-source">
                            ${p.rating > 0 ? `<span class="rating">‚≠ê ${p.rating}</span> ‚Ä¢ ` : ''}
                            <a href="${p.sourceUrl}" target="_blank">${p.source}</a>
                        </div>
                        <div class="component-detail">‚è±Ô∏è ${p.time}min ‚Ä¢ ${p.difficulty}</div>
                        <div class="instructions-list">
                            ${p.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                        </div>
                    </div>
                    
                    ${c ? `
                        <div class="component">
                            <h4>üçö ${c.name}</h4>
                            <div class="recipe-source">
                                ${c.rating > 0 ? `<span class="rating">‚≠ê ${c.rating}</span> ‚Ä¢ ` : ''}
                                <a href="${c.sourceUrl}" target="_blank">${c.source}</a>
                            </div>
                            <div class="component-detail">‚è±Ô∏è ${c.time}min ‚Ä¢ ${c.difficulty}</div>
                            <div class="instructions-list">
                                ${c.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="component">
                        <h4>ü•¨ ${v.name}</h4>
                        <div class="recipe-source">
                            ${v.rating > 0 ? `<span class="rating">‚≠ê ${v.rating}</span> ‚Ä¢ ` : ''}
                            <a href="${v.sourceUrl}" target="_blank">${v.source}</a>
                        </div>
                        <div class="component-detail">‚è±Ô∏è ${v.time}min ‚Ä¢ ${v.difficulty}</div>
                        <div class="instructions-list">
                            ${v.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                        </div>
                    </div>
                    
                    <div class="storage-note">üßä Store components separately, good for 3-4 days</div>
                </div>
            `;
        }

        function generateComplete(meal) {
            let meals = completeMeals[meal].filter(m => !excluded.has(m.protein) && !excluded.has(m.veggie));
            if (meals.length === 0) {
                showToast('No complete meals available!', 'error');
                return;
            }
            
            // Show loading state
            const displayEl = document.getElementById(`complete-${meal}-display`);
            displayEl.innerHTML = '<div class="loading-skeleton"></div>';
            
            setTimeout(() => {
                const m = rand(meals);
                current[`complete-${meal}`] = { type: 'complete', meal, ...m };
                displayComplete(meal, m);
            }, 500);
        }

        function displayComplete(meal, m) {
            const el = document.getElementById(`complete-${meal}-display`);
            
            el.innerHTML = `
                <div class="recipe-card">
                    <div class="recipe-top">
                        <div class="recipe-icon">${m.icon}</div>
                        <div class="recipe-info">
                            <div class="recipe-name">${m.name}</div>
                            <div class="recipe-source">
                                ${m.rating > 0 ? `<span class="rating">‚≠ê ${m.rating}</span> ‚Ä¢ ` : ''}
                                <a href="${m.sourceUrl}" target="_blank">${m.source}</a>
                            </div>
                            <div class="recipe-badges">
                                <span class="badge">‚è±Ô∏è ${m.time}min</span>
                                <span class="badge">${m.difficulty}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="component">
                        <h4>üìã Ingredients</h4>
                        ${m.ingredients.map(i => `<div class="component-detail">‚Ä¢ ${i}</div>`).join('')}
                    </div>
                    
                    <div class="component">
                        <h4>üë®‚Äçüç≥ Instructions</h4>
                        <div class="instructions-list">
                            ${m.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                        </div>
                    </div>
                    
                    <div class="storage-note">üßä Stores 3-4 days refrigerated</div>
                </div>
            `;
        }

        function addToWeek(key) {
            const meal = current[key];
            if (!meal) {
                showToast('Generate a meal first!', 'error');
                return;
            }
            
            weeklyMeals.push({ ...meal, id: Date.now() });
            save('weekly', weeklyMeals);
            renderWeekly();
            showToast('Added to Shopping List! üõí', 'success');
        }

        function renderWeekly() {
            const el = document.getElementById('weekly-meals');
            
            if (weeklyMeals.length === 0) {
                el.innerHTML = '<div class="empty-state" style="padding: 20px;">No meals added yet</div>';
                document.getElementById('save-list-btn').disabled = true;
                updateShoppingList();
                return;
            }
            
            el.innerHTML = weeklyMeals.map((m, i) => {
                const name = m.type === 'component' 
                    ? `${m.protein.name} + ${m.veggie.name}${m.carb ? ' + ' + m.carb.name : ''}`
                    : m.name;
                return `
                    <div class="weekly-meal">
                        <div class="weekly-meal-info">
                            <div class="weekly-meal-name">${name}</div>
                            <div class="weekly-meal-type">${m.type} ${m.meal}</div>
                        </div>
                        <button class="remove-btn" onclick="removeWeekly(${i})">√ó</button>
                    </div>
                `;
            }).join('');
            
            document.getElementById('save-list-btn').disabled = false;
            updateShoppingList();
        }

        function removeWeekly(idx) {
            weeklyMeals.splice(idx, 1);
            save('weekly', weeklyMeals);
            renderWeekly();
            showToast('Meal removed', 'info');
        }

        function addFavorite(key) {
            const meal = current[key];
            if (!meal) {
                showToast('Generate a meal first!', 'error');
                return;
            }
            
            favorites.push({ ...meal, id: Date.now() });
            save('favorites', favorites);
            renderFavorites();
            showToast('Added to favorites! ‚≠ê', 'success');
        }

        function renderFavorites() {
            const el = document.getElementById('favorites-list');
            
            if (favorites.length === 0) {
                el.innerHTML = '<div class="empty-state" style="padding: 20px;">No favorites yet</div>';
                return;
            }
            
            el.innerHTML = favorites.map((m, i) => {
                const name = m.type === 'component'
                    ? `${m.protein.name} + ${m.veggie.name}`
                    : m.name;
                return `
                    <div id="fav-${i}">
                        <div class="favorite-item-wrapper" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <div class="favorite-item" onclick="toggleFavoritePreview(${i})" style="flex: 1; margin-bottom: 0;">
                                <div class="favorite-name">${name}</div>
                                <div class="favorite-meta">${m.type} ${m.meal}</div>
                            </div>
                            <button class="remove-btn" onclick="removeFavorite(${i}); event.stopPropagation();" 
                                    title="Remove from favorites">√ó</button>
                        </div>
                        <div id="fav-preview-${i}" style="display: none;"></div>
                    </div>
                `;
            }).join('');
        }
        
        function toggleFavoritePreview(idx) {
            const previewEl = document.getElementById(`fav-preview-${idx}`);
            const fav = favorites[idx];
            
            // Close all other previews
            favorites.forEach((_, i) => {
                if (i !== idx) {
                    const otherPreview = document.getElementById(`fav-preview-${i}`);
                    if (otherPreview) otherPreview.style.display = 'none';
                }
            });
            
            // Toggle this preview
            if (previewEl.style.display === 'none') {
                // Generate preview content
                let previewHTML = '<div class="favorite-preview">';
                previewHTML += '<div class="favorite-preview-header">';
                previewHTML += `<div class="favorite-preview-title">üìñ Recipe Preview</div>`;
                previewHTML += `<button class="close-preview-btn" onclick="toggleFavoritePreview(${idx})">Close</button>`;
                previewHTML += '</div>';
                
                if (fav.type === 'component') {
                    previewHTML += generateComponentPreview(fav);
                } else {
                    previewHTML += generateCompletePreview(fav);
                }
                
                previewHTML += '</div>';
                previewEl.innerHTML = previewHTML;
                previewEl.style.display = 'block';
            } else {
                previewEl.style.display = 'none';
            }
        }
        
        function generateComponentPreview(fav) {
            let html = '';
            
            // Protein
            html += `<div class="component">
                <h4>üçñ ${fav.protein.name}</h4>
                <div class="component-detail">‚è±Ô∏è ${fav.protein.time}min ‚Ä¢ ${fav.protein.difficulty}</div>
                <div class="instructions-list">
                    ${fav.protein.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                </div>
            </div>`;
            
            // Carb (if lunch)
            if (fav.carb) {
                html += `<div class="component">
                    <h4>üçö ${fav.carb.name}</h4>
                    <div class="component-detail">‚è±Ô∏è ${fav.carb.time}min ‚Ä¢ ${fav.carb.difficulty}</div>
                    <div class="instructions-list">
                        ${fav.carb.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                    </div>
                </div>`;
            }
            
            // Veggie
            html += `<div class="component">
                <h4>ü•¨ ${fav.veggie.name}</h4>
                <div class="component-detail">‚è±Ô∏è ${fav.veggie.time}min ‚Ä¢ ${fav.veggie.difficulty}</div>
                <div class="instructions-list">
                    ${fav.veggie.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                </div>
            </div>`;
            
            return html;
        }
        
        function generateCompletePreview(fav) {
            let html = `<div class="component">
                <h4>üìã Ingredients</h4>
                ${fav.ingredients.map(i => `<div class="component-detail">‚Ä¢ ${i}</div>`).join('')}
            </div>`;
            
            html += `<div class="component">
                <h4>üë®‚Äçüç≥ Instructions</h4>
                <div class="instructions-list">
                    ${fav.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                </div>
            </div>`;
            
            return html;
        }
        
        function removeFavorite(idx) {
            favorites.splice(idx, 1);
            save('favorites', favorites);
            renderFavorites();
            showToast('Removed from favorites', 'info');
        }
        
        function clearRecipe(key) {
            const displayEl = document.getElementById(`${key}-display`);
            displayEl.innerHTML = '<div class="empty-state">Click generate to build your meal</div>';
            current[key] = null;
        }

        function loadFavorite(idx) {
            const fav = favorites[idx];
            if (fav.type === 'component') {
                current[`comp-${fav.meal}`] = fav;
                displayComponent(fav.meal, fav.protein, fav.veggie, fav.carb);
                switchTab('component');
                
                // Scroll to the recipe display
                setTimeout(() => {
                    const recipeEl = document.getElementById(`comp-${fav.meal}-display`);
                    if (recipeEl) {
                        recipeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            } else {
                current[`complete-${fav.meal}`] = fav;
                displayComplete(fav.meal, fav);
                switchTab('complete');
                
                // Scroll to the recipe display
                setTimeout(() => {
                    const recipeEl = document.getElementById(`complete-${fav.meal}-display`);
                    if (recipeEl) {
                        recipeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
        }

        // SHOPPING LIST with REAL GROCERY UNITS
        function updateShoppingList() {
            const el = document.getElementById('current-shopping-list');
            
            if (weeklyMeals.length === 0) {
                el.innerHTML = '<div class="empty-state">Add meals to "This Week\'s Plan" to build your shopping list</div>';
                return;
            }
            
            // Get current fridge inventory
            const fridgeItems = JSON.parse(localStorage.getItem('fridgeItems') || '[]');
            const fridgeInventory = {};
            
            fridgeItems.forEach(item => {
                if (item.status === 'raw') { // Only count raw items
                    const name = item.name.toLowerCase();
                    if (!fridgeInventory[name]) {
                        fridgeInventory[name] = {
                            amount: item.amount,
                            type: item.type
                        };
                    }
                }
            });
            
            const proteins = {}, carbs = {}, veggies = {};
            
            weeklyMeals.forEach(m => {
                if (m.type === 'component') {
                    proteins[m.protein.protein] = (proteins[m.protein.protein] || 0) + 1;
                    if (m.carb) carbs[m.carb.carb] = (carbs[m.carb.carb] || 0) + 1;
                    veggies[m.veggie.veggie] = (veggies[m.veggie.veggie] || 0) + 1;
                } else {
                    proteins[m.protein] = (proteins[m.protein] || 0) + 1;
                    if (m.carb) carbs[m.carb] = (carbs[m.carb] || 0) + 1;
                    veggies[m.veggie] = (veggies[m.veggie] || 0) + 1;
                }
            });
            
            // Helper function to check if item is in fridge
            function checkFridge(itemName) {
                const normalized = itemName.toLowerCase();
                return fridgeInventory[normalized];
            }
            
            // Helper function to extract numeric value from amount string
            function getNumericAmount(amountStr) {
                const match = amountStr.match(/(\d+(?:\.\d+)?)/);
                return match ? parseFloat(match[1]) : 0;
            }
            
            // Helper function to render item with fridge status
            function renderItem(name, details, inFridge, neededAmount) {
                if (inFridge) {
                    const haveAmount = getNumericAmount(inFridge.amount);
                    const needAmount = neededAmount || 0;
                    
                    // Check if we have enough
                    const hasEnough = haveAmount >= needAmount;
                    
                    if (hasEnough) {
                        // Have enough - show crossed out
                        return '<div class="shopping-item" style="background: rgba(16, 185, 129, 0.15); border-left: 3px solid #10b981;">' +
                               '<span style="text-decoration: line-through; opacity: 0.7;">' + cap(name) + ' ' + details + '</span> ' +
                               '<span style="color: #10b981; font-weight: 700; margin-left: 8px;">‚úì Have ' + inFridge.amount + '</span>' +
                               '</div>';
                    } else {
                        // Have some but not enough - show warning
                        const stillNeed = needAmount - haveAmount;
                        return '<div class="shopping-item" style="background: rgba(245, 158, 11, 0.15); border-left: 3px solid #f59e0b;">' +
                               cap(name) + ' <strong>' + details + '</strong> ' +
                               '<span style="color: #f59e0b; font-weight: 700; margin-left: 8px;">‚ö†Ô∏è Have ' + haveAmount + ', need ' + Math.ceil(stillNeed) + ' more</span>' +
                               '</div>';
                    }
                } else {
                    return '<div class="shopping-item">' + cap(name) + ' <strong>' + details + '</strong></div>';
                }
            }
            
            let proteinsHTML = Object.entries(proteins).map(([k, v]) => {
                const amount = v * 0.5;
                const inFridge = checkFridge(k);
                return renderItem(k, '(~' + amount + ' lbs)', inFridge);
            }).join('') || '<div class="shopping-item">None</div>';
            
            let carbsHTML = Object.entries(carbs).map(([k, v]) => {
                let unit = '';
                let neededAmount = v;
                if (k.includes('rice')) {
                    unit = '(' + v + ' cups dry rice)';
                    neededAmount = v; // cups
                } else if (k.includes('potato')) {
                    unit = '(' + (v * 3) + ' medium potatoes)';
                    neededAmount = v * 3; // potatoes
                } else if (k.includes('bread')) {
                    unit = '(1 loaf)';
                    neededAmount = 1;
                } else if (k.includes('quinoa')) {
                    unit = '(' + v + ' cups dry quinoa)';
                    neededAmount = v; // cups
                } else {
                    unit = '(' + v + ' servings)';
                    neededAmount = v; // servings
                }
                const inFridge = checkFridge(k);
                return renderItem(k, unit, inFridge, neededAmount);
            }).join('') || '<div class="shopping-item">None</div>';
            
            let veggiesHTML = Object.entries(veggies).map(([k, v]) => {
                let unit = '';
                let neededAmount = v;
                if (k.includes('broccoli')) {
                    unit = '(' + v + ' heads or 2 bags frozen)';
                    neededAmount = v;
                } else if (k.includes('brussels')) {
                    unit = '(' + v + ' lbs)';
                    neededAmount = v;
                } else if (k.includes('green beans')) {
                    unit = '(' + v + ' lbs or 2 bags frozen)';
                    neededAmount = v;
                } else if (k.includes('cabbage')) {
                    unit = '(1 head)';
                    neededAmount = 1;
                } else if (k.includes('onion')) {
                    unit = '(1 bag)';
                    neededAmount = 1;
                } else {
                    unit = '(' + (v * 2) + ' cups)';
                    neededAmount = v * 2;
                }
                const inFridge = checkFridge(k);
                return renderItem(k, unit, inFridge, neededAmount);
            }).join('') || '<div class="shopping-item">None</div>';
            
            el.innerHTML =
                '<div class="shopping-grid">' +
                    '<div class="shopping-category">' +
                        '<h4>üçñ Proteins</h4>' +
                        proteinsHTML +
                    '</div>' +
                    '<div class="shopping-category">' +
                        '<h4>üçö Carbs</h4>' +
                        carbsHTML +
                    '</div>' +
                    '<div class="shopping-category">' +
                        '<h4>ü•¨ Vegetables</h4>' +
                        veggiesHTML +
                    '</div>' +
                    '<div class="shopping-category">' +
                        '<h4>üßà Fats & Pantry</h4>' +
                        '<div class="shopping-item">Olive oil, coconut oil, or avocado oil</div>' +
                        '<div class="shopping-item">Garlic (1 bulb)</div>' +
                        '<div class="shopping-item">Onions (if not already listed)</div>' +
                        '<div class="shopping-item">Salt, pepper, herbs, spices</div>' +
                        '<div class="shopping-item">Lemon or lime</div>' +
                    '</div>' +
                '</div>';
            
            // Show purchase section when there are items
            document.getElementById('purchase-section').style.display = 'block';
        }

        function clearShoppingList() {
            if (weeklyMeals.length === 0) {
                showToast('Shopping list is already empty!', 'info');
                return;
            }
            
            if (confirm('Clear the current shopping list? This will remove all meals from "This Week\'s Plan".')) {
                weeklyMeals = [];
                localStorage.setItem('weekly', JSON.stringify(weeklyMeals));
                updateWeeklyMeals();
                updateShoppingList();
                showToast('Shopping list cleared! üóëÔ∏è', 'success');
            }
        }
        
        function saveAndStartNew() {
            if (weeklyMeals.length === 0) {
                showToast('No meals to save!', 'error');
                return;
            }
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            
            const proteins = {}, carbs = {}, veggies = {};
            weeklyMeals.forEach(m => {
                if (m.type === 'component') {
                    proteins[m.protein.protein] = (proteins[m.protein.protein] || 0) + 1;
                    if (m.carb) carbs[m.carb.carb] = (carbs[m.carb.carb] || 0) + 1;
                    veggies[m.veggie.veggie] = (veggies[m.veggie.veggie] || 0) + 1;
                } else {
                    proteins[m.protein] = (proteins[m.protein] || 0) + 1;
                    if (m.carb) carbs[m.carb] = (carbs[m.carb] || 0) + 1;
                    veggies[m.veggie] = (veggies[m.veggie] || 0) + 1;
                }
            });
            
            pastLists.unshift({
                id: Date.now(),
                date: dateStr,
                meals: [...weeklyMeals],
                proteins,
                carbs,
                veggies
            });
            
            if (pastLists.length > 10) pastLists = pastLists.slice(0, 10);
            
            localStorage.setItem('pastLists', JSON.stringify(pastLists));
            
            weeklyMeals = [];
            save('weekly', weeklyMeals);
            renderWeekly();
            
            showToast(`Shopping list saved for ${dateStr}! ‚úÖ`, 'success');
        }

        function viewPastLists() {
            const el = document.getElementById('past-lists-content');
            
            if (pastLists.length === 0) {
                el.innerHTML = '<div class="empty-state">No past lists yet</div>';
            } else {
                el.innerHTML = pastLists.map((list, idx) => `
                    <div class="past-list-card">
                        <div class="past-list-header">
                            <h3>üìÖ ${list.date}</h3>
                            <button class="btn-secondary" style="padding: 10px 20px; font-size: 0.9rem;" 
                                    onclick="deletePastList(${idx})">üóëÔ∏è Delete</button>
                        </div>
                        
                        <div class="past-list-meals">
                            <strong>Meals Planned:</strong>
                            <div style="margin-top: 10px;">
                                ${list.meals.map(m => {
                                    const name = m.type === 'component'
                                        ? `${m.protein.name} + ${m.veggie.name}${m.carb ? ' + ' + m.carb.name : ''}`
                                        : m.name;
                                    return `<div class="past-list-meal-item">‚Ä¢ ${name}</div>`;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="shopping-grid" style="margin-top: 15px;">
                            <div class="shopping-category">
                                <h4>üçñ Proteins</h4>
                                ${Object.entries(list.proteins).map(([k,v]) => 
                                    `<div class="shopping-item">${cap(k)} (~${v * 0.5} lbs)</div>`
                                ).join('')}
                            </div>
                            <div class="shopping-category">
                                <h4>üçö Carbs</h4>
                                ${Object.entries(list.carbs).length > 0 ? Object.entries(list.carbs).map(([k,v]) => 
                                    `<div class="shopping-item">${cap(k)}</div>`
                                ).join('') : '<div class="shopping-item">None</div>'}
                            </div>
                            <div class="shopping-category">
                                <h4>ü•¨ Vegetables</h4>
                                ${Object.entries(list.veggies).map(([k,v]) => 
                                    `<div class="shopping-item">${cap(k)}</div>`
                                ).join('')}
                            </div>
                            <div class="shopping-category">
                                <h4>üßà Pantry</h4>
                                <div class="shopping-item">Oils, spices, herbs</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('past-lists-modal').classList.add('show');
        }

        function deletePastList(idx) {
            pastLists.splice(idx, 1);
            localStorage.setItem('pastLists', JSON.stringify(pastLists));
            
            if (pastLists.length === 0) {
                document.getElementById('past-lists-content').innerHTML = '<div class="empty-state">No past lists yet</div>';
            } else {
                viewPastLists();
            }
            
            showToast('Shopping list deleted', 'info');
        }

        function closeModal(id) {
            if (id) {
                document.getElementById(id).classList.remove('show');
                
                // Reset prep mode when closing recipe browser
                if (id === 'recipe-browser-modal') {
                    document.getElementById('recipe-browser-content').removeAttribute('data-prep-mode');
                    currentPrepSlot = null;
                }
            } else {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
                document.getElementById('recipe-browser-content').removeAttribute('data-prep-mode');
                currentPrepSlot = null;
            }
        }

        function switchTab(type) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            document.getElementById(`${type}-tab`).classList.add('active');
        }

        function clearFilters() {
            excluded.clear();
            fridge.clear();
            save('excluded', excluded);
            save('fridge', fridge);
            document.getElementById('time-filter').value = 'any';
            document.getElementById('equipment-filter').value = 'any';
            updateTags();
            updateFridgeButtons();
        }

        function save(key, data) {
            localStorage.setItem(key, JSON.stringify([...data]));
        }

        function rand(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function cap(str) {
            return str.split(' ').map(w => w[0].toUpperCase() + w.slice(1)).join(' ');
        }
        
        // Meal Prep System
        let prepSlots = {
            1: null,
            2: null,
            3: null
        };
        let nextSlotId = 4; // Start at 4 since we have 3 initial slots
        
        // Fridge Tracker System
        let fridgeItems = JSON.parse(localStorage.getItem('fridgeItems') || '[]');
        
        function markGroceriesGot() {
            if (weeklyMeals.length === 0) {
                showToast('Add meals to your weekly plan first!', 'error');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            
            // Extract unique ingredients from weekly meals
            const proteins = {}, carbs = {}, veggies = {};
            
            weeklyMeals.forEach(m => {
                if (m.type === 'component') {
                    const proteinKey = m.protein.protein;
                    const veggieKey = m.veggie.veggie;
                    
                    if (!proteins[proteinKey]) {
                        proteins[proteinKey] = { count: 0, recipe: m.protein };
                    }
                    proteins[proteinKey].count++;
                    
                    if (!veggies[veggieKey]) {
                        veggies[veggieKey] = { count: 0, recipe: m.veggie };
                    }
                    veggies[veggieKey].count++;
                    
                    if (m.carb) {
                        const carbKey = m.carb.carb;
                        if (!carbs[carbKey]) {
                            carbs[carbKey] = { count: 0, recipe: m.carb };
                        }
                        carbs[carbKey].count++;
                    }
                } else {
                    // Complete meal
                    if (!proteins[m.protein]) {
                        proteins[m.protein] = { count: 0, name: m.protein };
                    }
                    proteins[m.protein].count++;
                    
                    if (!veggies[m.veggie]) {
                        veggies[m.veggie] = { count: 0, name: m.veggie };
                    }
                    veggies[m.veggie].count++;
                    
                    if (m.carb) {
                        if (!carbs[m.carb]) {
                            carbs[m.carb] = { count: 0, name: m.carb };
                        }
                        carbs[m.carb].count++;
                    }
                }
            });
            
            // Add proteins to fridge
            Object.entries(proteins).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count * 0.5} lbs`,
                    type: 'protein',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 3,
                    shelfLifeCooked: 4
                });
            });
            
            // Add veggies to fridge
            Object.entries(veggies).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count} servings`,
                    type: 'veggie',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 5,
                    shelfLifeCooked: 4
                });
            });
            
            // Add carbs to fridge
            Object.entries(carbs).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count} servings`,
                    type: 'carb',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 7,
                    shelfLifeCooked: 5
                });
            });
            
            localStorage.setItem('fridgeItems', JSON.stringify(fridgeItems));
            renderFridgeTracker();
            switchTab('cooktrack');
            
            showToast(`Added ${Object.keys(proteins).length + Object.keys(veggies).length + Object.keys(carbs).length} items to fridge tracker! üßä`, 'success');
        }
        
        function renderFridgeTracker() {
            const rawEl = document.getElementById('raw-items-list');
            const cookedEl = document.getElementById('cooked-items-list');
            
            // If elements don't exist (not on cook-track page), skip rendering
            if (!rawEl || !cookedEl) return;
            
            const rawItems = fridgeItems.filter(item => item.status === 'raw');
            const cookedItems = fridgeItems.filter(item => item.status === 'cooked');
            
            // Render raw items
            if (rawItems.length === 0) {
                rawEl.innerHTML = '<div class="empty-state">No raw ingredients tracked yet</div>';
            } else {
                rawEl.innerHTML = rawItems.map(item => {
                    const freshness = calculateFreshness(item);
                    return renderFridgeItem(item, freshness, true);
                }).join('');
            }
            
            // Render cooked items
            if (cookedItems.length === 0) {
                cookedEl.innerHTML = '<div class="empty-state">No cooked items yet - start cooking!</div>';
            } else {
                cookedEl.innerHTML = cookedItems.map(item => {
                    const freshness = calculateFreshness(item);
                    return renderFridgeItem(item, freshness, false);
                }).join('');
            }
        }
        
        function calculateFreshness(item) {
            const today = new Date();
            const referenceDate = item.status === 'cooked' ? new Date(item.dateCooked) : new Date(item.dateAdded);
            const shelfLife = item.status === 'cooked' ? item.shelfLifeCooked : item.shelfLifeRaw;
            
            const diffTime = today - referenceDate;
            const daysOld = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const daysLeft = shelfLife - daysOld;
            
            let status, color, stars;
            if (daysLeft <= 0) {
                status = 'urgent';
                color = '#ef4444';
                stars = 'üî¥';
            } else if (daysLeft <= 1) {
                status = 'urgent';
                color = '#ef4444';
                stars = 'üî¥';
            } else if (daysLeft <= 2) {
                status = 'soon';
                color = '#f59e0b';
                stars = 'üü°';
            } else {
                status = 'fresh';
                color = '#10b981';
                stars = 'üü¢';
            }
            
            const percentage = Math.max(0, Math.min(100, (daysLeft / shelfLife) * 100));
            
            return {
                dayNumber: daysOld + 1,
                totalDays: shelfLife,
                daysLeft: Math.max(0, daysLeft),
                status,
                color,
                stars,
                percentage,
                daysOld
            };
        }
        
        function renderFridgeItem(item, freshness, isRaw) {
            const dateLabel = isRaw ? 'Bought' : 'Cooked';
            const dateValue = isRaw ? item.dateAdded : item.dateCooked;
            const expireDate = new Date(dateValue);
            expireDate.setDate(expireDate.getDate() + (isRaw ? item.shelfLifeRaw : item.shelfLifeCooked));
            
            return `
                <div class="fridge-item ${freshness.status}">
                    <div class="fridge-item-header">
                        <div>
                            <div class="fridge-item-name">${freshness.stars} ${item.name}</div>
                            <div class="fridge-item-amount">${item.amount}</div>
                        </div>
                    </div>
                    
                    <div class="fridge-item-dates">
                        <div>üìÖ ${dateLabel}: ${formatDate(dateValue)}</div>
                        <div>‚è∞ Eat by: ${formatDate(expireDate.toISOString().split('T')[0])}</div>
                    </div>
                    
                    <div class="freshness-indicator">
                        <div class="freshness-bar">
                            <div class="freshness-fill ${freshness.status}" style="width: ${freshness.percentage}%"></div>
                        </div>
                        <div class="freshness-text" style="color: ${freshness.color}">
                            ${isRaw ? 
                                (freshness.daysLeft <= 1 ? 'Cook today!' : `${freshness.daysLeft} days left`) :
                                `Day ${freshness.dayNumber} of ${freshness.totalDays}`
                            }
                        </div>
                    </div>
                    
                    <div class="fridge-item-actions">
                        ${isRaw ? 
                            `<button class="btn-green" onclick="markAsCooked(${item.id})">üç≥ Mark as Cooked</button>` :
                            `<button class="btn-pink" onclick="markAsEaten(${item.id})">‚úÖ Ate This</button>`
                        }
                        <button class="btn-secondary" onclick="removeFridgeItem(${item.id})">üóëÔ∏è Remove</button>
                    </div>
                </div>
            `;
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dateOnly = dateStr.split('T')[0];
            const todayStr = today.toISOString().split('T')[0];
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            if (dateOnly === todayStr) return 'Today';
            if (dateOnly === yesterdayStr) return 'Yesterday';
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function markAsCooked(itemId) {
            const item = fridgeItems.find(i => i.id === itemId);
            if (item) {
                item.status = 'cooked';
                item.dateCooked = new Date().toISOString().split('T')[0];
                localStorage.setItem('fridgeItems', JSON.stringify(fridgeItems));
                renderFridgeTracker();
                showToast(`${item.name} marked as cooked! üç≥`, 'success');
            }
        }
        
        function markAsEaten(itemId) {
            const item = fridgeItems.find(i => i.id === itemId);
            if (item) {
                fridgeItems = fridgeItems.filter(i => i.id !== itemId);
                localStorage.setItem('fridgeItems', JSON.stringify(fridgeItems));
                renderFridgeTracker();
                showToast(`${item.name} removed - enjoy your meal! üçΩÔ∏è`, 'success');
            }
        }
        
        function removeFridgeItem(itemId) {
            fridgeItems = fridgeItems.filter(i => i.id !== itemId);
            localStorage.setItem('fridgeItems', JSON.stringify(fridgeItems));
            renderFridgeTracker();
            showToast('Item removed from fridge tracker', 'info');
        }
        
        // Initialize fridge tracker on page load
        document.addEventListener('DOMContentLoaded', function() {
            renderFridgeTracker();
        });
        
        function addAnotherPrepSlot() {
            const slotNum = nextSlotId++;
            const container = document.getElementById('mealprep-slots');
            
            const newSlot = document.createElement('div');
            newSlot.className = 'meal-box';
            newSlot.id = `prep-slot-container-${slotNum}`;
            newSlot.innerHTML = `
                <div class="meal-header">
                    <div class="meal-title">Recipe #${slotNum}</div>
                    <button class="clear-recipe-btn" onclick="removePrepSlotContainer(${slotNum})" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        üóëÔ∏è Remove Slot
                    </button>
                </div>
                <div id="prep-slot-${slotNum}" class="recipe-display">
                    <div class="empty-state">Click "Select Recipe" to choose what to batch cook</div>
                </div>
                <div class="action-buttons">
                    <button onclick="selectPrepRecipe(${slotNum})">üìã Select Recipe</button>
                    <div id="prep-servings-${slotNum}" style="display: none; align-items: center; gap: 10px;">
                        <label style="color: white; font-weight: 600;">Servings:</label>
                        <select id="prep-qty-${slotNum}" style="padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-weight: 600;">
                            <option value="2">2 servings</option>
                            <option value="3">3 servings</option>
                            <option value="4" selected>4 servings</option>
                            <option value="5">5 servings</option>
                            <option value="6">6 servings</option>
                            <option value="7">7 servings</option>
                            <option value="8">8 servings</option>
                            <option value="10">10 servings</option>
                            <option value="12">12 servings</option>
                        </select>
                        <button class="clear-recipe-btn" onclick="clearPrepSlot(${slotNum})">‚úï Clear</button>
                    </div>
                </div>
            `;
            
            container.appendChild(newSlot);
            prepSlots[slotNum] = null;
            
            showToast(`Added Recipe Slot #${slotNum}`, 'success');
            
            // Scroll to new slot
            setTimeout(() => {
                newSlot.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }
        
        function removePrepSlotContainer(slotNum) {
            delete prepSlots[slotNum];
            const container = document.getElementById(`prep-slot-container-${slotNum}`);
            if (container) {
                container.remove();
                showToast(`Removed Recipe Slot #${slotNum}`, 'info');
                updateShelfLifeBreakdown();
            }
        }
        
        function updateShelfLifeBreakdown() {
            const section = document.getElementById('shelf-life-section');
            const breakdown = document.getElementById('shelf-life-breakdown');
            
            // Check if any slots have recipes
            const hasRecipes = Object.values(prepSlots).some(slot => slot !== null);
            
            if (!hasRecipes) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            
            // Group by ingredient type and shelf life
            const shelfLifeData = {};
            
            Object.entries(prepSlots).forEach(([slotNum, slot]) => {
                if (!slot) return;
                
                const { recipe, type } = slot;
                const qty = parseInt(document.getElementById(`prep-qty-${slotNum}`)?.value || 4);
                
                let ingredient, shelfLife, amount;
                
                if (type === 'protein') {
                    ingredient = cap(recipe.protein);
                    shelfLife = '3-4 days';
                    amount = `${qty * 0.5} lbs`;
                } else if (type === 'veggie') {
                    ingredient = cap(recipe.veggie);
                    shelfLife = '3-5 days (cooked)';
                    amount = `${qty} servings`;
                } else if (type === 'carb') {
                    ingredient = cap(recipe.carb);
                    shelfLife = '4-5 days';
                    amount = `${qty} servings`;
                } else if (type.includes('complete')) {
                    ingredient = recipe.name;
                    shelfLife = '3-4 days';
                    amount = `${qty} servings`;
                }
                
                if (!shelfLifeData[shelfLife]) {
                    shelfLifeData[shelfLife] = [];
                }
                
                shelfLifeData[shelfLife].push({ ingredient, amount, recipe: recipe.name });
            });
            
            // Render breakdown
            let html = '';
            
            Object.entries(shelfLifeData).forEach(([shelfLife, items]) => {
                html += `
                    <div class="shopping-category">
                        <h4 style="color: #fbbf24;">‚è±Ô∏è ${shelfLife}</h4>
                        ${items.map(item => `
                            <div class="shopping-item">
                                <strong>${item.amount}</strong> ${item.ingredient}
                                <div style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 4px;">
                                    ${item.recipe}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            breakdown.innerHTML = html;
        }
        
        function selectPrepRecipe(slotNum) {
            // Open recipe browser in "prep mode"
            currentPrepSlot = slotNum;
            document.getElementById('recipe-browser-content').setAttribute('data-prep-mode', 'true');
            openRecipeBrowser();
        }
        
        let currentPrepSlot = null;
        
        function addRecipeToPrepSlot(recipe, type) {
            // If no slot specified (called from browser buttons), find first empty slot
            let slotNum = currentPrepSlot;
            
            if (!slotNum) {
                // Find first available slot
                if (!prepSlots[1]) slotNum = 1;
                else if (!prepSlots[2]) slotNum = 2;
                else if (!prepSlots[3]) slotNum = 3;
                else {
                    showToast('All 3 meal prep slots are full! Clear one first.', 'error');
                    return;
                }
            }
            
            prepSlots[slotNum] = { recipe, type };
            
            // Display the recipe
            const slotEl = document.getElementById(`prep-slot-${slotNum}`);
            const servingsEl = document.getElementById(`prep-servings-${slotNum}`);
            
            let shelfLife = 'N/A';
            if (type === 'protein') shelfLife = '3-4 days';
            else if (type === 'veggie') shelfLife = '3-5 days';
            else if (type === 'carb') shelfLife = '4-5 days';
            else if (type.includes('complete')) shelfLife = '3-4 days';
            
            slotEl.innerHTML = `
                <div class="recipe-card">
                    <div class="recipe-top">
                        <div style="font-size: 2.5rem;">${recipe.icon}</div>
                        <div class="recipe-info">
                            <div class="recipe-name">${recipe.name}</div>
                            <div class="recipe-badges">
                                <span class="badge">‚è±Ô∏è ${recipe.time}min</span>
                                <span class="badge">‚ùÑÔ∏è ${shelfLife} in fridge</span>
                                ${recipe.rating > 0 ? `<span class="badge rating">‚≠ê ${recipe.rating}</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            servingsEl.style.display = 'flex';
            
            // Close modal if it was open
            const modal = document.getElementById('recipe-browser-modal');
            if (modal.classList.contains('show')) {
                closeModal('recipe-browser-modal');
            }
            
            currentPrepSlot = null;
            
            // Update shelf life breakdown
            updateShelfLifeBreakdown();
            
            // Switch to meal prep tab to show the result
            switchTab('mealprep');
            
            showToast(`Added to Meal Prep Slot #${slotNum}! üç±`, 'success');
            
            // Scroll to meal prep tab
            setTimeout(() => {
                document.getElementById('mealprep-tab').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
        
        function clearPrepSlot(slotNum) {
            prepSlots[slotNum] = null;
            document.getElementById(`prep-slot-${slotNum}`).innerHTML = 
                '<div class="empty-state">Click "Select Recipe" to choose what to batch cook</div>';
            document.getElementById(`prep-servings-${slotNum}`).style.display = 'none';
            updateShelfLifeBreakdown();
        }
        
        function addAllPrepToWeek() {
            let addedCount = 0;
            
            for (let slotNum in prepSlots) {
                const slot = prepSlots[slotNum];
                if (!slot) continue;
                
                const qty = parseInt(document.getElementById(`prep-qty-${slotNum}`).value);
                const { recipe, type } = slot;
                
                // Add this recipe qty times to weekly meals
                for (let i = 0; i < qty; i++) {
                    let mealData;
                    
                    if (type.includes('complete')) {
                        const mealType = type.split('-')[1];
                        mealData = { type: 'complete', meal: mealType, ...recipe };
                    } else {
                        // Component recipe
                        mealData = {
                            type: 'component',
                            meal: 'lunch',
                            protein: type === 'protein' ? recipe : { name: 'TBD', protein: 'tbd', instructions: [] },
                            veggie: type === 'veggie' ? recipe : { name: 'TBD', veggie: 'tbd', instructions: [] },
                            carb: type === 'carb' ? recipe : null
                        };
                    }
                    
                    weeklyMeals.push({ ...mealData, id: Date.now() + i });
                    addedCount++;
                }
            }
            
            if (addedCount === 0) {
                showToast('No recipes selected!', 'error');
                return;
            }
            
            save('weekly', weeklyMeals);
            renderWeekly();
            showToast(`Added ${addedCount} servings to This Week! üéâ`, 'success');
        }
        
        // Recipe Browser System
        let browserSelection = { protein: null, veggie: null, carb: null };
        
        function openRecipeBrowser() {
            const el = document.getElementById('recipe-browser-content');
            
            // Check if we're in prep mode
            const isPrepMode = el.getAttribute('data-prep-mode') === 'true';
            
            // Update modal title if in prep mode
            const modalTitle = document.querySelector('#recipe-browser-modal h2');
            if (modalTitle) {
                modalTitle.textContent = isPrepMode ? 'üç± Select Recipe for Meal Prep' : 'üìö Browse All Recipes';
            }
            
            const modalDesc = document.querySelector('#recipe-browser-modal p');
            if (modalDesc) {
                modalDesc.textContent = isPrepMode ? 
                    'Choose a recipe to add to your meal prep plan' : 
                    'Click any recipe to use it in your meal plan';
            }
            
            let html = '';
            
            // Protein Recipes
            html += '<div class="recipe-category-header">üçñ Protein Recipes</div>';
            html += '<div class="recipe-browser-grid">';
            proteinRecipes.forEach((recipe, idx) => {
                html += `
                    <div class="recipe-browser-card" id="protein-card-${idx}">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${recipe.icon}</div>
                        <h4>${recipe.name}</h4>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; margin: 8px 0;">
                            ${cap(recipe.protein)}
                        </div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${recipe.time}min</span>
                            <span class="badge">${recipe.difficulty}</span>
                            ${recipe.rating > 0 ? `<span class="badge rating">‚≠ê ${recipe.rating}</span>` : ''}
                        </div>
                        <button class="expand-recipe-btn" onclick="toggleRecipeDetails('protein', ${idx}); event.stopPropagation();">
                            üìñ View Recipe
                        </button>
                        <div class="recipe-details" id="protein-details-${idx}">
                            <div class="component">
                                <h4>üë®‚Äçüç≥ Instructions</h4>
                                <div class="instructions-list">
                                    ${recipe.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                                </div>
                            </div>
                            <div class="recipe-browser-actions">
                                <button class="btn-purple" onclick="addBrowserRecipeToWeek('protein', ${idx}); event.stopPropagation();">
                                    ‚ûï Add to Week
                                </button>
                                <button class="btn-green" onclick="addRecipeToPrepSlot(proteinRecipes[${idx}], 'protein'); event.stopPropagation();">
                                    üç± Batch Prep
                                </button>
                                <button class="btn-pink" onclick="addBrowserRecipeToFavorites('protein', ${idx}); event.stopPropagation();">
                                    ‚ù§Ô∏è Favorite
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Veggie Recipes
            html += '<div class="recipe-category-header">ü•¨ Vegetable Recipes</div>';
            html += '<div class="recipe-browser-grid">';
            veggieRecipes.forEach((recipe, idx) => {
                html += `
                    <div class="recipe-browser-card" id="veggie-card-${idx}">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${recipe.icon}</div>
                        <h4>${recipe.name}</h4>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; margin: 8px 0;">
                            ${cap(recipe.veggie)}
                        </div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${recipe.time}min</span>
                            <span class="badge">${recipe.difficulty}</span>
                            ${recipe.rating > 0 ? `<span class="badge rating">‚≠ê ${recipe.rating}</span>` : ''}
                        </div>
                        <button class="expand-recipe-btn" onclick="toggleRecipeDetails('veggie', ${idx}); event.stopPropagation();">
                            üìñ View Recipe
                        </button>
                        <div class="recipe-details" id="veggie-details-${idx}">
                            <div class="component">
                                <h4>üë®‚Äçüç≥ Instructions</h4>
                                <div class="instructions-list">
                                    ${recipe.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                                </div>
                            </div>
                            <div class="recipe-browser-actions">
                                <button class="btn-purple" onclick="addBrowserRecipeToWeek('veggie', ${idx}); event.stopPropagation();">
                                    ‚ûï Add to Week
                                </button>
                                <button class="btn-green" onclick="addRecipeToPrepSlot(veggieRecipes[${idx}], 'veggie'); event.stopPropagation();">
                                    üç± Batch Prep
                                </button>
                                <button class="btn-pink" onclick="addBrowserRecipeToFavorites('veggie', ${idx}); event.stopPropagation();">
                                    ‚ù§Ô∏è Favorite
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Carb Recipes
            html += '<div class="recipe-category-header">üçö Carb Recipes</div>';
            html += '<div class="recipe-browser-grid">';
            carbRecipes.forEach((recipe, idx) => {
                html += `
                    <div class="recipe-browser-card" id="carb-card-${idx}">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${recipe.icon}</div>
                        <h4>${recipe.name}</h4>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; margin: 8px 0;">
                            ${cap(recipe.carb)}
                        </div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${recipe.time}min</span>
                            <span class="badge">${recipe.difficulty}</span>
                            ${recipe.rating > 0 ? `<span class="badge rating">‚≠ê ${recipe.rating}</span>` : ''}
                        </div>
                        <button class="expand-recipe-btn" onclick="toggleRecipeDetails('carb', ${idx}); event.stopPropagation();">
                            üìñ View Recipe
                        </button>
                        <div class="recipe-details" id="carb-details-${idx}">
                            <div class="component">
                                <h4>üë®‚Äçüç≥ Instructions</h4>
                                <div class="instructions-list">
                                    ${recipe.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                                </div>
                            </div>
                            <div class="recipe-browser-actions">
                                <button class="btn-purple" onclick="addBrowserRecipeToWeek('carb', ${idx}); event.stopPropagation();">
                                    ‚ûï Add to Week
                                </button>
                                <button class="btn-green" onclick="addRecipeToPrepSlot(carbRecipes[${idx}], 'carb'); event.stopPropagation();">
                                    üç± Batch Prep
                                </button>
                                <button class="btn-pink" onclick="addBrowserRecipeToFavorites('carb', ${idx}); event.stopPropagation();">
                                    ‚ù§Ô∏è Favorite
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Complete Meals - Lunch
            html += '<div class="recipe-category-header">üçΩÔ∏è Complete Meals - Lunch</div>';
            html += '<div class="recipe-browser-grid">';
            completeMeals.lunch.forEach((meal, idx) => {
                html += `
                    <div class="recipe-browser-card" id="complete-lunch-card-${idx}">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${meal.icon}</div>
                        <h4>${meal.name}</h4>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; margin: 8px 0;">
                            ${cap(meal.protein)} ‚Ä¢ ${cap(meal.veggie)}
                        </div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${meal.time}min</span>
                            <span class="badge">${meal.difficulty}</span>
                            ${meal.rating > 0 ? `<span class="badge rating">‚≠ê ${meal.rating}</span>` : ''}
                        </div>
                        <button class="expand-recipe-btn" onclick="toggleRecipeDetails('complete-lunch', ${idx}); event.stopPropagation();">
                            üìñ View Recipe
                        </button>
                        <div class="recipe-details" id="complete-lunch-details-${idx}">
                            <div class="component">
                                <h4>üìã Ingredients</h4>
                                ${meal.ingredients.map(i => `<div class="component-detail">‚Ä¢ ${i}</div>`).join('')}
                            </div>
                            <div class="component">
                                <h4>üë®‚Äçüç≥ Instructions</h4>
                                <div class="instructions-list">
                                    ${meal.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                                </div>
                            </div>
                            <div class="recipe-browser-actions">
                                <button class="btn-purple" onclick="addBrowserRecipeToWeek('complete-lunch', ${idx}); event.stopPropagation();">
                                    ‚ûï Add to Week
                                </button>
                                <button class="btn-green" onclick="addRecipeToPrepSlot(completeMeals.lunch[${idx}], 'complete-lunch'); event.stopPropagation();">
                                    üç± Batch Prep
                                </button>
                                <button class="btn-pink" onclick="addBrowserRecipeToFavorites('complete-lunch', ${idx}); event.stopPropagation();">
                                    ‚ù§Ô∏è Favorite
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Complete Meals - Dinner
            html += '<div class="recipe-category-header">üçΩÔ∏è Complete Meals - Dinner</div>';
            html += '<div class="recipe-browser-grid">';
            completeMeals.dinner.forEach((meal, idx) => {
                html += `
                    <div class="recipe-browser-card" id="complete-dinner-card-${idx}">
                        <div style="font-size: 2rem; margin-bottom: 10px;">${meal.icon}</div>
                        <h4>${meal.name}</h4>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; margin: 8px 0;">
                            ${cap(meal.protein)} ‚Ä¢ ${cap(meal.veggie)}
                        </div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${meal.time}min</span>
                            <span class="badge">${meal.difficulty}</span>
                            ${meal.rating > 0 ? `<span class="badge rating">‚≠ê ${meal.rating}</span>` : ''}
                        </div>
                        <button class="expand-recipe-btn" onclick="toggleRecipeDetails('complete-dinner', ${idx}); event.stopPropagation();">
                            üìñ View Recipe
                        </button>
                        <div class="recipe-details" id="complete-dinner-details-${idx}">
                            <div class="component">
                                <h4>üìã Ingredients</h4>
                                ${meal.ingredients.map(i => `<div class="component-detail">‚Ä¢ ${i}</div>`).join('')}
                            </div>
                            <div class="component">
                                <h4>üë®‚Äçüç≥ Instructions</h4>
                                <div class="instructions-list">
                                    ${meal.instructions.map(s => `<div class="instruction-step">${s}</div>`).join('')}
                                </div>
                            </div>
                            <div class="recipe-browser-actions">
                                <button class="btn-purple" onclick="addBrowserRecipeToWeek('complete-dinner', ${idx}); event.stopPropagation();">
                                    ‚ûï Add to Week
                                </button>
                                <button class="btn-green" onclick="addRecipeToPrepSlot(completeMeals.dinner[${idx}], 'complete-dinner'); event.stopPropagation();">
                                    üç± Batch Prep
                                </button>
                                <button class="btn-pink" onclick="addBrowserRecipeToFavorites('complete-dinner', ${idx}); event.stopPropagation();">
                                    ‚ù§Ô∏è Favorite
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            el.innerHTML = html;
            document.getElementById('recipe-browser-modal').classList.add('show');
        }
        
        function selectProteinRecipe(idx) {
            browserSelection.protein = proteinRecipes[idx];
            showToast(`Selected: ${proteinRecipes[idx].name}`, 'success');
            checkBrowserSelection();
        }
        
        function selectVeggieRecipe(idx) {
            browserSelection.veggie = veggieRecipes[idx];
            showToast(`Selected: ${veggieRecipes[idx].name}`, 'success');
            checkBrowserSelection();
        }
        
        function selectCarbRecipe(idx) {
            browserSelection.carb = carbRecipes[idx];
            showToast(`Selected: ${carbRecipes[idx].name}`, 'success');
            checkBrowserSelection();
        }
        
        function toggleRecipeDetails(type, idx) {
            const detailsEl = document.getElementById(`${type}-details-${idx}`);
            const cardEl = document.getElementById(`${type}-card-${idx}`);
            const btnEl = cardEl.querySelector('.expand-recipe-btn');
            
            if (detailsEl.classList.contains('show')) {
                detailsEl.classList.remove('show');
                cardEl.classList.remove('expanded');
                btnEl.textContent = 'üìñ View Recipe';
            } else {
                detailsEl.classList.add('show');
                cardEl.classList.add('expanded');
                btnEl.textContent = 'üìñ Hide Recipe';
            }
        }
        
        function addBrowserRecipeToWeek(type, idx) {
            // Check if we're in prep mode
            const isPrepMode = document.getElementById('recipe-browser-content').getAttribute('data-prep-mode') === 'true';
            
            let recipe;
            
            if (type === 'complete-lunch' || type === 'complete-dinner') {
                const mealType = type.split('-')[1];
                recipe = completeMeals[mealType][idx];
                
                if (isPrepMode) {
                    addRecipeToPrepSlot(recipe, type);
                    return;
                }
                
                const mealData = { type: 'complete', meal: mealType, ...recipe };
                weeklyMeals.push({ ...mealData, id: Date.now() });
            } else {
                // Component recipe
                if (type === 'protein') {
                    recipe = proteinRecipes[idx];
                } else if (type === 'veggie') {
                    recipe = veggieRecipes[idx];
                } else if (type === 'carb') {
                    recipe = carbRecipes[idx];
                }
                
                if (isPrepMode) {
                    addRecipeToPrepSlot(recipe, type);
                    return;
                }
                
                const mealData = {
                    type: 'component',
                    meal: 'lunch',
                    protein: type === 'protein' ? recipe : { name: 'TBD', protein: 'tbd', instructions: [] },
                    veggie: type === 'veggie' ? recipe : { name: 'TBD', veggie: 'tbd', instructions: [] },
                    carb: type === 'carb' ? recipe : null
                };
                
                weeklyMeals.push({ ...mealData, id: Date.now() });
            }
            
            save('weekly', weeklyMeals);
            renderWeekly();
            showToast(`Added ${recipe.name} to This Week! üéâ`, 'success');
        }
        
        function addBrowserRecipeToFavorites(type, idx) {
            let recipe;
            let mealData;
            
            if (type === 'complete-lunch' || type === 'complete-dinner') {
                const mealType = type.split('-')[1];
                recipe = completeMeals[mealType][idx];
                mealData = { type: 'complete', meal: mealType, ...recipe };
            } else {
                // Component recipe
                if (type === 'protein') {
                    recipe = proteinRecipes[idx];
                } else if (type === 'veggie') {
                    recipe = veggieRecipes[idx];
                } else if (type === 'carb') {
                    recipe = carbRecipes[idx];
                }
                
                mealData = {
                    type: 'component',
                    meal: 'lunch',
                    protein: type === 'protein' ? recipe : { name: 'TBD', protein: 'tbd', instructions: [] },
                    veggie: type === 'veggie' ? recipe : { name: 'TBD', veggie: 'tbd', instructions: [] },
                    carb: type === 'carb' ? recipe : null
                };
            }
            
            favorites.push({ ...mealData, id: Date.now() });
            save('favorites', favorites);
            renderFavorites();
            showToast(`Added ${recipe.name} to favorites! ‚≠ê`, 'success');
        }
        
        function selectCompleteMeal(type, idx) {
            const meal = completeMeals[type][idx];
            current[`complete-${type}`] = { type: 'complete', meal: type, ...meal };
            displayComplete(type, meal);
            closeModal('recipe-browser-modal');
            switchTab('complete');
            showToast(`Loaded: ${meal.name}`, 'success');
            
            setTimeout(() => {
                const recipeEl = document.getElementById(`complete-${type}-display`);
                if (recipeEl) recipeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }
        
        function checkBrowserSelection() {
            if (browserSelection.protein && browserSelection.veggie) {
                const hasCarb = !!browserSelection.carb;
                const mealType = hasCarb ? 'lunch' : 'dinner';
                
                current[`comp-${mealType}`] = {
                    type: 'component',
                    meal: mealType,
                    protein: browserSelection.protein,
                    veggie: browserSelection.veggie,
                    carb: browserSelection.carb
                };
                
                displayComponent(mealType, browserSelection.protein, browserSelection.veggie, browserSelection.carb);
                closeModal('recipe-browser-modal');
                switchTab('component');
                
                showToast(`Created your custom ${mealType}!`, 'success');
                browserSelection = { protein: null, veggie: null, carb: null };
                
                setTimeout(() => {
                    const recipeEl = document.getElementById(`comp-${mealType}-display`);
                    if (recipeEl) recipeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }
        
        // Toast notification system
        // Mark items as purchased
        function markAllPurchased() {
            if (weeklyMeals.length === 0) {
                showToast('No items in shopping list!', 'error');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            
            // Extract ingredients and add to fridgeItems (stored in localStorage)
            let fridgeItems = JSON.parse(localStorage.getItem('fridgeItems') || '[]');
            
            const proteins = {}, carbs = {}, veggies = {};
            
            weeklyMeals.forEach(m => {
                if (m.type === 'component') {
                    const proteinKey = m.protein.protein;
                    const veggieKey = m.veggie.veggie;
                    
                    if (!proteins[proteinKey]) {
                        proteins[proteinKey] = { count: 0, recipe: m.protein };
                    }
                    proteins[proteinKey].count++;
                    
                    if (!veggies[veggieKey]) {
                        veggies[veggieKey] = { count: 0, recipe: m.veggie };
                    }
                    veggies[veggieKey].count++;
                    
                    if (m.carb) {
                        const carbKey = m.carb.carb;
                        if (!carbs[carbKey]) {
                            carbs[carbKey] = { count: 0, recipe: m.carb };
                        }
                        carbs[carbKey].count++;
                    }
                } else {
                    if (!proteins[m.protein]) {
                        proteins[m.protein] = { count: 0, name: m.protein };
                    }
                    proteins[m.protein].count++;
                    
                    if (!veggies[m.veggie]) {
                        veggies[m.veggie] = { count: 0, name: m.veggie };
                    }
                    veggies[m.veggie].count++;
                    
                    if (m.carb) {
                        if (!carbs[m.carb]) {
                            carbs[m.carb] = { count: 0, name: m.carb };
                        }
                        carbs[m.carb].count++;
                    }
                }
            });
            
            // Add proteins to fridge
            Object.entries(proteins).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count * 0.5} lbs`,
                    type: 'protein',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 3,
                    shelfLifeCooked: 4,
                    recipe: data.recipe
                });
            });
            
            // Add veggies
            Object.entries(veggies).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count} servings`,
                    type: 'veggie',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 5,
                    shelfLifeCooked: 4,
                    recipe: data.recipe
                });
            });
            
            // Add carbs
            Object.entries(carbs).forEach(([key, data]) => {
                fridgeItems.push({
                    id: Date.now() + Math.random(),
                    name: cap(key),
                    amount: `${data.count} servings`,
                    type: 'carb',
                    status: 'raw',
                    dateAdded: today,
                    dateCooked: null,
                    shelfLifeRaw: 7,
                    shelfLifeCooked: 5,
                    recipe: data.recipe
                });
            });
            
            localStorage.setItem('fridgeItems', JSON.stringify(fridgeItems));
            
            // Refresh the fridge dropdown to show newly purchased items
            const fr = document.getElementById('fridge-select');
            fr.innerHTML = '<option value="">What you have...</option>';
            fridgeItems.forEach(item => {
                const option = new Option(item.name, item.name.toLowerCase());
                fr.add(option);
            });
            
            const totalItems = Object.keys(proteins).length + Object.keys(veggies).length + Object.keys(carbs).length;
            showToast('‚úÖ Marked ' + totalItems + ' items as purchased! Go to Cook & Track page to see your fridge.', 'success');
        }
        
        function openManualAddFromPage1() {
            // Redirect to cook-track page with flag to open manual add modal
            localStorage.setItem('openManualAdd', 'true');
            window.location.href = 'cook-track.html';
        }
        
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>